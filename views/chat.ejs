<%- include("../partials/head.ejs") -%>
<body>
    <div id="new-message">

    </div>

    <textarea name="new-chat" id="new-chat"></textarea>

    <button id="message">Send Message</button>
</body>
<script>
    if (window.location.href == "http://localhost:<%= PORT %>/chat/<%= reciever %>") {
        const userName = prompt("What is your username?");
        window.location.replace("http://localhost:<%= PORT %>/chat/<%= reciever %>?sender=" + userName);
    }

    const url = "ws://localhost:<%= PORT %>";
    const wsServer = new WebSocket(url);

    const newChat = document.getElementById("new-chat");
    function sendMessage() {
        console.log(newChat.value)
        if (newChat.value) {
            const data = {
                sender,
                reciever,
                message: newChat.value
            }
            wsServer.send(JSON.stringify(data));
            newChat.value = "";
        }
    }

    const button = document.getElementById("message");
    button.addEventListener("click", () => {
        sendMessage();
    })

    const messageContainer = document.getElementById("new-message");

    function displayMessage(message) {
        let newMessage = document.createElement("p");
        newMessage.innerText = message;
        messageContainer.appendChild(newMessage);
    }

    wsServer.onmessage = (event) => {
        const { data } = event;
        console.log(data);
        displayMessage(data);
    }

</script>
</html>